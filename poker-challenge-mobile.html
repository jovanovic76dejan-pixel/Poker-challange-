<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#7c3aed">
    <title>Poker Grind Challenge</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUG9rZXIgR3JpbmQgQ2hhbGxlbmdlIiwic2hvcnRfbmFtZSI6IlBva2VyIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMxZTE5MmUiLCJ0aGVtZV9jb2xvciI6IiM3YzNhZWQifQ==">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Simple storage implementation for browsers without window.storage
        const simpleStorage = {
            async get(key) {
                try {
                    const value = localStorage.getItem(key);
                    return value ? { key, value } : null;
                } catch (e) {
                    return null;
                }
            },
            async set(key, value) {
                try {
                    localStorage.setItem(key, value);
                    return { key, value };
                } catch (e) {
                    return null;
                }
            },
            async delete(key) {
                try {
                    localStorage.removeItem(key);
                    return { key, deleted: true };
                } catch (e) {
                    return null;
                }
            }
        };
        
        if (!window.storage) {
            window.storage = simpleStorage;
        }

        const PokerChallengeApp = () => {
          const [view, setView] = useState('setup');
          const [challenge, setChallenge] = useState(null);
          const [sessions, setSessions] = useState([]);
          const [activeSession, setActiveSession] = useState(null);
          const [sessionTimer, setSessionTimer] = useState(0);
          const [sessionResult, setSessionResult] = useState('');
          const [sessionFeeling, setSessionFeeling] = useState('ok');
          const [sessionNotes, setSessionNotes] = useState('');
          const [selectedStake, setSelectedStake] = useState('low');
          const [editingGoal, setEditingGoal] = useState(false);
          const [newGoal, setNewGoal] = useState('');

          const [setupData, setSetupData] = useState({
            startBR: '',
            goalBR: '',
            experience: 'intermediate',
            site: 'pokerstars',
            tables: 2,
            availability: {
              mon: 5, tue: 5, wed: 4.5, thu: 2.5, fri: 2.5, sat: 2.5, sun: 2.5
            }
          });

          useEffect(() => {
            const loadData = async () => {
              try {
                const savedChallenge = await window.storage.get('poker_challenge');
                const savedSessions = await window.storage.get('poker_sessions');
                
                if (savedChallenge) {
                  setChallenge(JSON.parse(savedChallenge.value));
                  setView('dashboard');
                }
                if (savedSessions) {
                  setSessions(JSON.parse(savedSessions.value));
                }
              } catch (error) {
                console.log('No saved data');
              }
            };
            loadData();
          }, []);

          useEffect(() => {
            const saveData = async () => {
              try {
                if (challenge) {
                  await window.storage.set('poker_challenge', JSON.stringify(challenge));
                }
                if (sessions.length > 0) {
                  await window.storage.set('poker_sessions', JSON.stringify(sessions));
                }
              } catch (error) {
                console.log('Storage not available');
              }
            };
            saveData();
          }, [challenge, sessions]);

          useEffect(() => {
            let interval;
            if (activeSession) {
              interval = setInterval(() => {
                setSessionTimer(prev => prev + 1);
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [activeSession]);

          const calculateStrategy = (start, goal, exp, site, numTables = 2) => {
            const startBR = parseFloat(start);
            const goalAmount = parseFloat(goal);
            
            const baseMonthsPerDoubling = {
              'beginner': 2.0,
              'intermediate': 1.5,
              'advanced': 1.2
            };
            
            const rakeMultiplier = {
              'pokerstars': 1.3,
              'ggpoker': 1.15,
              'other': 1.0
            };
            
            const tablesMultiplier = {
              1: 1.8, 2: 1.0, 3: 0.8, 4: 0.7, 5: 0.65, 6: 0.62
            };
            
            const tableMulti = tablesMultiplier[Math.min(numTables, 6)] || tablesMultiplier[6];
            const monthsPerDoubling = baseMonthsPerDoubling[exp] * rakeMultiplier[site] * tableMulti;
            
            const doublings = Math.log2(goalAmount / startBR);
            const totalMonths = Math.ceil(doublings * monthsPerDoubling);
            const totalWeeks = totalMonths * 4;
            
            const stakes = [
              { name: 'NL2', bb: 0.02, minBI: 25, moveUp: 30 },
              { name: 'NL5', bb: 0.05, minBI: 25, moveUp: 30 },
              { name: 'NL10', bb: 0.10, minBI: 25, moveUp: 30 },
              { name: 'NL25', bb: 0.25, minBI: 25, moveUp: 30 },
              { name: 'NL50', bb: 0.50, minBI: 25, moveUp: 30 },
              { name: 'NL100', bb: 1.00, minBI: 25, moveUp: 30 },
              { name: 'NL200', bb: 2.00, minBI: 30, moveUp: 35 },
              { name: 'NL500', bb: 5.00, minBI: 30, moveUp: 35 }
            ];
            
            let currentStakeIndex = 0;
            for (let i = 0; i < stakes.length; i++) {
              if (startBR >= stakes[i].minBI * stakes[i].bb * 100) {
                currentStakeIndex = i;
              }
            }
            
            const levels = [];
            let currentBR = startBR;
            
            while (currentBR < goalAmount && currentStakeIndex < stakes.length) {
              const stake = stakes[currentStakeIndex];
              const buyIn = stake.bb * 100;
              const moveUpBR = stake.moveUp * buyIn;
              const dropDownBR = (stake.minBI - 3) * buyIn;
              
              if (currentBR >= moveUpBR) {
                currentStakeIndex++;
                continue;
              }
              
              const levelTarget = Math.min(moveUpBR, goalAmount);
              
              if (levelTarget <= currentBR) {
                currentStakeIndex++;
                continue;
              }
              
              const doublingsForLevel = Math.log2(levelTarget / currentBR);
              
              if (doublingsForLevel < 0.1) {
                currentBR = levelTarget;
                currentStakeIndex++;
                continue;
              }
              
              const levelMonths = Math.max(1, Math.ceil(doublingsForLevel * monthsPerDoubling));
              
              const baseWinrate = exp === 'beginner' ? 2 : exp === 'intermediate' ? 3.5 : 5;
              const rakeImpact = stake.bb < 0.25 ? 1.5 : stake.bb < 1.0 ? 0.8 : 0.5;
              const adjustedWinrate = Math.max(0.5, baseWinrate - rakeImpact);
              
              levels.push({
                stake: stake.name,
                buyIn: buyIn,
                startBR: currentBR,
                targetBR: levelTarget,
                minBR: dropDownBR,
                winrate: adjustedWinrate.toFixed(1),
                estimatedMonths: levelMonths,
                estimatedWeeks: levelMonths * 4,
                stopLoss: currentBR * 0.10,
                doublings: doublingsForLevel.toFixed(2)
              });
              
              currentBR = levelTarget;
              currentStakeIndex++;
            }
            
            const totalHoursPerWeek = Object.values(setupData.availability).reduce((sum, day) => sum + day.hours, 0);
            
            return {
              levels,
              totalWeeks,
              totalMonths,
              hoursPerWeek: totalHoursPerWeek,
              tables: numTables,
              currentLevel: levels[0],
              doublings: doublings.toFixed(2),
              monthsPerDoubling: monthsPerDoubling.toFixed(1),
              estimatedCompletion: new Date(Date.now() + totalMonths * 30 * 24 * 60 * 60 * 1000).toLocaleDateString('sv-SE'),
              model: 'exponential',
              isRealistic: totalMonths <= 60
            };
          };

          const startChallenge = () => {
            const strategy = calculateStrategy(setupData.startBR, setupData.goalBR, setupData.experience, setupData.site, setupData.tables);
            setChallenge({
              ...setupData,
              strategy,
              currentBR: parseFloat(setupData.startBR),
              startDate: new Date().toISOString(),
              currentLevelIndex: 0
            });
            setView('dashboard');
          };

          const updateGoal = () => {
            if (!newGoal || parseFloat(newGoal) <= challenge.currentBR) {
              alert('Nytt m√•l m√•ste vara h√∂gre √§n nuvarande bankroll!');
              return;
            }
            
            const updatedStrategy = calculateStrategy(
              challenge.currentBR.toString(),
              newGoal,
              challenge.experience,
              challenge.site,
              challenge.tables
            );
            
            setChallenge({
              ...challenge,
              goalBR: newGoal,
              strategy: updatedStrategy
            });
            
            setEditingGoal(false);
            setNewGoal('');
          };

          const startSession = () => {
            setActiveSession({
              id: Date.now(),
              startTime: new Date().toISOString(),
              stake: challenge.strategy.currentLevel.stake,
              stopLoss: challenge.strategy.currentLevel.stopLoss
            });
            setSessionTimer(0);
            setSessionResult('');
            setSessionFeeling('ok');
            setSessionNotes('');
            setView('session');
          };

          const endSession = () => {
            if (!sessionResult) {
              alert('Ange resultat f√∂r sessionen!');
              return;
            }

            const completedSession = {
              ...activeSession,
              endTime: new Date().toISOString(),
              duration: sessionTimer,
              result: parseFloat(sessionResult),
              feeling: sessionFeeling,
              notes: sessionNotes
            };

            const newSessions = [...sessions, completedSession];
            setSessions(newSessions);

            const newBR = challenge.currentBR + parseFloat(sessionResult);
            const currentLevel = challenge.strategy.currentLevel;
            let newLevelIndex = challenge.currentLevelIndex;

            if (newBR >= currentLevel.targetBR && challenge.currentLevelIndex < challenge.strategy.levels.length - 1) {
              newLevelIndex++;
              alert('üéâ Grattis! Du har flyttat upp till ' + challenge.strategy.levels[newLevelIndex].stake);
            } else if (newBR <= currentLevel.minBR && challenge.currentLevelIndex > 0) {
              newLevelIndex--;
              alert('‚ö†Ô∏è Bankrullen har sjunkit. Du flyttas ner till ' + challenge.strategy.levels[newLevelIndex].stake);
            }

            setChallenge({
              ...challenge,
              currentBR: newBR,
              currentLevelIndex: newLevelIndex,
              strategy: {
                ...challenge.strategy,
                currentLevel: challenge.strategy.levels[newLevelIndex]
              }
            });

            setActiveSession(null);
            setView('dashboard');
          };

          const formatTime = (seconds) => {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return h.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0') + ':' + s.toString().padStart(2, '0');
          };

          const calculateStats = () => {
            if (sessions.length === 0) return null;
            const totalProfit = sessions.reduce((sum, s) => sum + s.result, 0);
            const totalHours = sessions.reduce((sum, s) => sum + s.duration, 0) / 3600;
            const winningSessions = sessions.filter(s => s.result > 0).length;
            return {
              totalProfit: totalProfit.toFixed(2),
              totalHours: totalHours.toFixed(1),
              hourlyRate: (totalProfit / totalHours).toFixed(2),
              winRate: (winningSessions / sessions.length * 100).toFixed(1),
              sessionsPlayed: sessions.length
            };
          };

          const exportToCSV = () => {
            const headers = ['Date', 'Stake', 'Duration (min)', 'Result ($)', 'Feeling', 'Notes', 'Bankroll'];
            let csv = headers.join(',') + '\\n';
            
            let runningBR = parseFloat(challenge.startBR);
            sessions.forEach(s => {
              runningBR += s.result;
              const row = [
                new Date(s.startTime).toLocaleDateString('sv-SE'),
                s.stake,
                Math.floor(s.duration / 60),
                s.result.toFixed(2),
                s.feeling,
                '"' + (s.notes || '').replace(/"/g, '""') + '"',
                runningBR.toFixed(2)
              ];
              csv += row.join(',') + '\\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'poker-sessions-' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
          };

          const resetChallenge = async () => {
            if (!window.confirm('Are you sure? This will delete all data!')) return;
            
            try {
              await window.storage.delete('poker_challenge');
              await window.storage.delete('poker_sessions');
            } catch (error) {
              console.log('Could not delete storage');
            }
            
            setChallenge(null);
            setSessions([]);
            setActiveSession(null);
            setView('setup');
          };

          // SETUP VIEW
          if (view === 'setup') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                <div className="max-w-4xl mx-auto pt-8">
                  <div className="text-center mb-8">
                    <h1 className="text-4xl font-bold text-white mb-2">
                      ‚ö° Poker Grind Challenge
                    </h1>
                    <p className="text-purple-200">AI-Powered Bankroll Management</p>
                  </div>

                  <div className="bg-white/95 rounded-lg p-6">
                    <h2 className="text-xl font-bold mb-6 flex items-center gap-2">
                      üéØ Skapa Din Challenge
                    </h2>
                    
                    <div className="space-y-6">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-2">Start Bankroll ($)</label>
                          <input
                            type="number"
                            value={setupData.startBR}
                            onChange={(e) => setSetupData({...setupData, startBR: e.target.value})}
                            className="w-full p-3 border rounded-lg text-lg"
                            placeholder="Ange start"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-2">M√•l ($)</label>
                          <input
                            type="number"
                            value={setupData.goalBR}
                            onChange={(e) => setSetupData({...setupData, goalBR: e.target.value})}
                            className="w-full p-3 border rounded-lg text-lg"
                            placeholder="Ange m√•l"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-2">Erfarenhet</label>
                          <select
                            value={setupData.experience}
                            onChange={(e) => setSetupData({...setupData, experience: e.target.value})}
                            className="w-full p-3 border rounded-lg"
                          >
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-2">Site</label>
                          <select
                            value={setupData.site}
                            onChange={(e) => setSetupData({...setupData, site: e.target.value})}
                            className="w-full p-3 border rounded-lg"
                          >
                            <option value="pokerstars">PokerStars</option>
                            <option value="ggpoker">GGPoker</option>
                            <option value="other">Other</option>
                          </select>
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-2">
                          Antal bord samtidigt
                        </label>
                        <div className="grid grid-cols-6 gap-2">
                          {[1, 2, 3, 4, 5, 6].map(num => (
                            <button
                              key={num}
                              onClick={() => setSetupData({...setupData, tables: num})}
                              className={`p-3 rounded-lg font-bold border-2 ${
                                setupData.tables === num
                                  ? 'bg-purple-600 text-white border-purple-600'
                                  : 'bg-white border-gray-300'
                              }`}
                            >
                              {num}
                            </button>
                          ))}
                        </div>
                      </div>

                      <button
                        onClick={startChallenge}
                        disabled={!setupData.startBR || !setupData.goalBR}
                        className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-lg font-bold text-lg disabled:opacity-50"
                      >
                        üöÄ Starta Challenge
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // SESSION VIEW
          if (view === 'session' && activeSession && challenge) {
            const currentLoss = parseFloat(sessionResult || 0);
            const stopLossReached = currentLoss <= -challenge.strategy.currentLevel.stopLoss;
            const stopLossPercent = Math.abs(currentLoss / challenge.strategy.currentLevel.stopLoss * 100);

            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                <div className="max-w-4xl mx-auto pt-8">
                  <div className="bg-white/95 rounded-lg p-6">
                    <div className="flex items-center justify-between mb-6">
                      <div className="flex items-center gap-2">
                        <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span className="text-xl font-bold">{challenge.strategy.currentLevel.stake}</span>
                      </div>
                      <span className="text-2xl font-mono">{formatTime(sessionTimer)}</span>
                    </div>

                    <div className="space-y-6">
                      <div className="grid grid-cols-2 gap-4">
                        <div className="p-6 bg-blue-50 rounded-lg text-center">
                          <p className="text-sm text-gray-600 mb-2">Buy-In</p>
                          <p className="text-3xl font-bold text-blue-600">
                            ${challenge.strategy.currentLevel.buyIn.toFixed(2)}
                          </p>
                        </div>
                        <div className="p-6 bg-red-50 rounded-lg text-center">
                          <p className="text-sm text-gray-600 mb-2">Stop Loss</p>
                          <p className="text-3xl font-bold text-red-600">
                            ${challenge.strategy.currentLevel.stopLoss.toFixed(2)}
                          </p>
                        </div>
                      </div>

                      {currentLoss < 0 && (
                        <div>
                          <div className="flex justify-between text-sm mb-2">
                            <span>Current Loss</span>
                            <span className={`font-bold ${stopLossReached ? 'text-red-600' : 'text-orange-600'}`}>
                              ${currentLoss.toFixed(2)} ({stopLossPercent.toFixed(0)}%)
                            </span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-4">
                            <div 
                              className={`h-4 rounded-full ${stopLossReached ? 'bg-red-600' : 'bg-orange-500'}`}
                              style={{width: Math.min(stopLossPercent, 100) + '%'}}
                            />
                          </div>
                        </div>
                      )}

                      {stopLossReached && (
                        <div className="p-4 bg-red-50 border-2 border-red-600 rounded-lg">
                          <p className="text-red-800 font-bold">üõë STOP LOSS REACHED!</p>
                        </div>
                      )}

                      <div>
                        <label className="block text-sm font-medium mb-2">Resultat ($)</label>
                        <input
                          type="number"
                          value={sessionResult}
                          onChange={(e) => setSessionResult(e.target.value)}
                          className="w-full p-4 border-2 rounded-lg text-xl"
                          placeholder="0.00"
                          step="0.01"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-2">K√§nslor</label>
                        <div className="grid grid-cols-3 gap-3">
                          {[
                            {value: 'good', emoji: 'üòä', label: 'Fokuserad'},
                            {value: 'ok', emoji: 'üòê', label: 'OK'},
                            {value: 'bad', emoji: 'üò§', label: 'Tiltad'}
                          ].map(option => (
                            <button
                              key={option.value}
                              onClick={() => setSessionFeeling(option.value)}
                              className={`p-4 rounded-lg border-2 ${
                                sessionFeeling === option.value 
                                  ? 'border-purple-500 bg-purple-50' 
                                  : 'border-gray-200'
                              }`}
                            >
                              <div className="text-3xl mb-1">{option.emoji}</div>
                              <div className="text-sm font-medium">{option.label}</div>
                            </button>
                          ))}
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-2">Anteckningar</label>
                        <textarea
                          value={sessionNotes}
                          onChange={(e) => setSessionNotes(e.target.value)}
                          className="w-full p-3 border rounded-lg"
                          rows="3"
                          placeholder="Valfritt..."
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <button
                          onClick={() => {
                            if (window.confirm('Avbryta session?')) {
                              setActiveSession(null);
                              setView('dashboard');
                            }
                          }}
                          className="py-3 border-2 border-gray-300 rounded-lg font-medium"
                        >
                          Avbryt
                        </button>
                        <button
                          onClick={endSession}
                          className="py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-bold"
                        >
                          ‚úÖ Avsluta
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // DASHBOARD VIEW
          if (view === 'dashboard' && challenge) {
            const stats = calculateStats();
            const progress = ((challenge.currentBR - parseFloat(challenge.startBR)) / (parseFloat(challenge.goalBR) - parseFloat(challenge.startBR)) * 100).toFixed(1);
            const currentLevel = challenge.strategy.currentLevel;
            const buyInsAvailable = (challenge.currentBR / currentLevel.buyIn).toFixed(1);

            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                <div className="max-w-7xl mx-auto pt-4">
                  <div className="flex gap-2 mb-6 overflow-x-auto">
                    <button onClick={() => setView('dashboard')} className="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium whitespace-nowrap">Dashboard</button>
                    <button onClick={() => setView('settings')} className="px-4 py-2 bg-slate-700 text-white rounded-lg font-medium whitespace-nowrap">Settings</button>
                  </div>

                  <div className="grid grid-cols-2 gap-4 mb-6">
                    <div className="bg-white/95 rounded-lg p-4">
                      <p className="text-sm text-gray-600">Bankroll</p>
                      <p className="text-2xl font-bold text-green-600">${challenge.currentBR.toFixed(2)}</p>
                    </div>

                    <div className="bg-white/95 rounded-lg p-4">
                      <p className="text-sm text-gray-600">M√•l</p>
                      {editingGoal ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="number"
                            value={newGoal}
                            onChange={(e) => setNewGoal(e.target.value)}
                            className="w-24 p-1 border rounded font-bold"
                            placeholder={challenge.goalBR}
                            autoFocus
                          />
                          <button
                            onClick={updateGoal}
                            className="px-2 py-1 bg-green-600 text-white rounded text-xs"
                          >
                            ‚úì
                          </button>
                          <button
                            onClick={() => {setEditingGoal(false); setNewGoal('');}}
                            className="px-2 py-1 bg-gray-400 text-white rounded text-xs"
                          >
                            ‚úï
                          </button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2">
                          <p className="text-2xl font-bold text-orange-600">${challenge.goalBR}</p>
                          <button
                            onClick={() => {setEditingGoal(true); setNewGoal(challenge.goalBR);}}
                            className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium"
                          >
                            √Ñndra
                          </button>
                        </div>
                      )}
                    </div>

                    <div className="bg-white/95 rounded-lg p-4">
                      <p className="text-sm text-gray-600">Progress</p>
                      <p className="text-2xl font-bold text-purple-600">{progress}%</p>
                    </div>

                    <div className="bg-white/95 rounded-lg p-4">
                      <p className="text-sm text-gray-600">Stake</p>
                      <p className="text-2xl font-bold text-blue-600">{currentLevel.stake}</p>
                    </div>
                  </div>

                  <div className="bg-white/95 rounded-lg p-6 mb-6">
                    <h3 className="text-lg font-bold mb-4">Current Level: {currentLevel.stake}</h3>
                    
                    <div className="mb-4">
                      <div className="flex justify-between text-sm mb-2">
                        <span>Progress</span>
                        <span>{buyInsAvailable} buy-ins</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-3">
                        <div 
                          className="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full"
                          style={{width: Math.min(((challenge.currentBR - currentLevel.startBR) / (currentLevel.targetBR - currentLevel.startBR)) * 100, 100) + '%'}}
                        />
                      </div>
                    </div>

                    <div className="grid grid-cols-3 gap-4 mb-4">
                      <div className="text-center p-3 bg-green-50 rounded-lg">
                        <p className="text-xs text-gray-600">Move Up</p>
                        <p className="text-lg font-bold text-green-600">${currentLevel.targetBR}</p>
                      </div>
                      <div className="text-center p-3 bg-blue-50 rounded-lg">
                        <p className="text-xs text-gray-600">Stop Loss</p>
                        <p className="text-lg font-bold text-blue-600">${currentLevel.stopLoss.toFixed(2)}</p>
                      </div>
                      <div className="text-center p-3 bg-red-50 rounded-lg">
                        <p className="text-xs text-gray-600">Drop Down</p>
                        <p className="text-lg font-bold text-red-600">${currentLevel.minBR}</p>
                      </div>
                    </div>

                    <button
                      onClick={startSession}
                      className="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-4 rounded-lg font-bold text-lg"
                    >
                      ‚ñ∂Ô∏è Start Session
                    </button>
                  </div>

                  <div className="bg-white/95 rounded-lg p-6 mb-6">
                    <h3 className="text-lg font-bold mb-4">Estimat</h3>
                    <div className="grid grid-cols-2 gap-4 text-sm bg-blue-50 p-4 rounded-lg">
                      <div>
                        <span className="text-gray-600">Total tid:</span>
                        <span className="ml-2 font-bold">{challenge.strategy.totalMonths} m√•nader</span>
                      </div>
                      <div>
                        <span className="text-gray-600">Doublings:</span>
                        <span className="ml-2 font-bold">{challenge.strategy.doublings}x</span>
                      </div>
                      <div>
                        <span className="text-gray-600">Per doubling:</span>
                        <span className="ml-2 font-bold">{challenge.strategy.monthsPerDoubling} m√•n</span>
                      </div>
                      <div>
                        <span className="text-gray-600">Antal bord:</span>
                        <span className="ml-2 font-bold">{challenge.strategy.tables} samtidigt</span>
                      </div>
                    </div>
                  </div>

                  <div className="bg-white/95 rounded-lg p-6 mb-6">
                    <h3 className="text-lg font-bold mb-4">Progression Plan</h3>
                    <div className="space-y-3">
                      {challenge.strategy.levels.map((level, idx) => (
                        <div 
                          key={idx}
                          className={`p-4 rounded-lg border-2 ${
                            idx === challenge.currentLevelIndex
                              ? 'bg-gradient-to-r from-purple-50 to-blue-50 border-purple-400'
                              : idx < challenge.currentLevelIndex
                              ? 'bg-green-50 border-green-300'
                              : 'bg-gray-50 border-gray-200'
                          }`}
                        >
                          <div className="flex items-center justify-between">
                            <div>
                              <h4 className="font-bold text-lg">{level.stake}</h4>
                              <p className="text-sm text-gray-600">${level.startBR.toFixed(0)} ‚Üí ${level.targetBR.toFixed(0)}</p>
                              <p className="text-xs text-purple-600">{level.doublings}x doublings</p>
                            </div>
                            <div className="text-right text-sm">
                              <div className="text-gray-600">WR: {level.winrate}bb/100</div>
                              <div className="font-bold text-blue-600">ca {level.estimatedMonths} m√•n</div>
                              <div className="font-medium text-red-600">SL: ${level.stopLoss.toFixed(2)}</div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  {stats && (
                    <div className="bg-white/95 rounded-lg p-6">
                      <h3 className="text-lg font-bold mb-4">Statistics</h3>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="text-center p-4 bg-purple-50 rounded-lg">
                          <p className="text-sm text-gray-600 mb-1">Profit</p>
                          <p className={`text-2xl font-bold ${parseFloat(stats.totalProfit) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                            ${stats.totalProfit}
                          </p>
                        </div>
                        <div className="text-center p-4 bg-blue-50 rounded-lg">
                          <p className="text-sm text-gray-600 mb-1">Hours</p>
                          <p className="text-2xl font-bold text-blue-600">{stats.totalHours}h</p>
                        </div>
                        <div className="text-center p-4 bg-green-50 rounded-lg">
                          <p className="text-sm text-gray-600 mb-1">$/Hour</p>
                          <p className="text-2xl font-bold text-green-600">${stats.hourlyRate}</p>
                        </div>
                        <div className="text-center p-4 bg-orange-50 rounded-lg">
                          <p className="text-sm text-gray-600 mb-1">Win Rate</p>
                          <p className="text-2xl font-bold text-orange-600">{stats.winRate}%</p>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // SETTINGS VIEW
          if (view === 'settings' && challenge) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                <div className="max-w-4xl mx-auto pt-4">
                  <div className="flex gap-2 mb-6">
                    <button onClick={() => setView('dashboard')} className="px-4 py-2 bg-slate-700 text-white rounded-lg font-medium">Dashboard</button>
                    <button onClick={() => setView('settings')} className="px-4 py-2 bg-purple-600 text-white rounded-lg font-medium">Settings</button>
                  </div>

                  <div className="bg-white/95 rounded-lg p-6 mb-6">
                    <h3 className="text-lg font-bold mb-4">Settings & Tools</h3>
                    
                    <div className="space-y-6">
                      <div className="p-4 bg-green-50 rounded-lg">
                        <h4 className="font-bold mb-3">Export Data</h4>
                        <button
                          onClick={exportToCSV}
                          className="w-full px-4 py-3 bg-green-600 text-white rounded-lg font-medium"
                        >
                          üìÑ Export CSV
                        </button>
                      </div>

                      <div className="p-4 bg-red-50 rounded-lg border-2 border-red-300">
                        <h4 className="font-bold mb-2 text-red-700">Danger Zone</h4>
                        <p className="text-sm text-gray-600 mb-3">
                          Reset challenge and delete all data
                        </p>
                        <button
                          onClick={resetChallenge}
                          className="w-full px-4 py-3 bg-red-600 text-white rounded-lg font-medium"
                        >
                          üóëÔ∏è Reset Challenge
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(<PokerChallengeApp />, document.getElementById('root'));
    </script>
</body>
</html>
